<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HOI4 Guides</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;500;600&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <style>
    *, *::before, *::after { box-sizing: border-box; }
    body {
      background-color: #000000;
      color: #a8a8b0;
      font-family: 'Lora', Georgia, serif;
      font-weight: 500;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      min-height: 100vh;
    }
    h1 { color: #ffffff; font-size: 2.2em; font-weight: 600; margin-bottom: 8px; }
    h2 { color: #e0e0e8; font-size: 1.5em; border-bottom: 1px solid #111115; padding-bottom: 10px; }
    .highlight { color: #9b59f7; font-weight: 600; }
    
    #country-selector {
      max-width: 1100px;
      width: 100%;
      padding: 60px 40px;
      text-align: left;
    }
    .grid {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      margin-top: 40px;
    }
    .country-card {
      background: #080808;
      border: 1px solid #1a1a1f;
      padding: 24px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: left;
      width: 320px;
      height: 160px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }
    .country-card:hover {
      border-color: #9b59f7;
      background: #0c0015;
      transform: translateY(-2px);
    }
    .country-card.disabled {
      opacity: 0.3;
      cursor: not-allowed;
      filter: grayscale(1);
    }
    .country-card h3 { 
      color: #ffffff; 
      margin: 0; 
      font-family: 'JetBrains Mono', monospace; 
      font-size: 1.2em;
    }
    .country-card p {
      font-size: 0.85em;
      margin: 8px 0;
      color: #666;
      line-height: 1.4;
      flex-grow: 1;
    }

    #guide-interface {
      display: none;
      width: 100%;
      max-width: 1100px;
      padding: 60px 40px;
    }

    .top-nav-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: 30px 0;
      gap: 20px;
    }

    .info-badge {
      background: #0c0015;
      border: 1px solid #9b59f7;
      color: #9b59f7;
      padding: 8px 16px;
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.85em;
      border-radius: 4px;
    }

    /* Mini Tabs Styling */
    .mini-tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    .mini-tab {
      background: #0a0a0a;
      border: 1px solid #1a1a1f;
      color: #555;
      padding: 6px 12px;
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.7em;
      cursor: pointer;
      text-transform: uppercase;
      transition: all 0.2s ease;
    }
    .mini-tab:hover {
      border-color: #444;
      color: #888;
    }
    .mini-tab.active {
      background: #110022;
      border-color: #9b59f7;
      color: #9b59f7;
    }

    .screenshot-trigger {
      background: #080808;
      border: 1px solid #1a1a1f;
      color: #a8a8b0;
      padding: 8px 24px;
      font-family: 'JetBrains Mono', monospace;
      cursor: pointer;
      font-size: 0.9em;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .screenshot-trigger:hover, .screenshot-trigger.active {
      background: #0c0015;
      border-color: #9b59f7;
      color: #9b59f7;
    }

    .guide-container {
      display: grid;
      grid-template-columns: 180px 1fr;
      gap: 40px;
      border-top: 1px solid #1a1a1a;
      padding-top: 40px;
    }
    .sidebar-dots {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    .tab-item {
      display: flex;
      align-items: center;
      gap: 12px;
      cursor: pointer;
    }
    .tab-dot {
      width: 10px;
      height: 10px;
      background: #1a1a1f;
      border: 1px solid #222228;
      border-radius: 2px;
      transition: all 0.2s ease;
    }
    .tab-item.active .tab-dot, .tab-item:hover .tab-dot {
      background: #9b59f7;
      border-color: #9b59f7;
    }
    .tab-label {
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.75em;
      text-transform: uppercase;
      color: #444450;
    }
    .tab-item.active .tab-label { color: #9b59f7; }

    .content-box {
      background: #050505;
      border: 1px solid #111115;
      padding: 40px;
      min-height: 550px;
    }
    .meta-value {
      font-family: 'Lora', Georgia, serif;
      font-weight: 500;
      background: #0a0a0a;
      padding: 24px;
      border-left: 2px solid #9b59f7;
      margin: 24px 0;
      color: #b0b0bc;
      line-height: 1.8;
      font-size: 0.95em;
    }
    .meta-value ol {
      margin: 0;
      padding-left: 2em;
      list-style: decimal;
    }
    .meta-value ol li {
      margin: 0;
      padding: 1px 0;
    }
    .meta-value ul {
      margin: 4px 0 10px 1em;
      padding-left: 1em;
      list-style: none;
    }
    .meta-value ul li::before {
      content: "— ";
      color: #9b59f7;
    }
    .meta-value .section-head {
      color: #9b59f7;
      font-size: 0.8em;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      margin: 16px 0 6px;
      display: block;
    }
    .meta-value .tip {
      color: #666;
      font-style: italic;
    }

    .library-placeholder {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 300px;
      border: 1px dashed #1a1a1f;
      text-align: center;
    }
    .library-placeholder p {
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.8em;
      color: #444;
      margin-top: 15px;
    }

    #back-btn {
      background: transparent;
      border: 1px solid #1a1a1f;
      color: #444450;
      padding: 6px 14px;
      cursor: pointer;
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.8em;
      margin-bottom: 20px;
    }
    #back-btn:hover { color: #9b59f7; border-color: #9b59f7; }

    /* Checkbox mode */
    .meta-value.checkbox-mode ol li {
      cursor: pointer;
      display: flex;
      align-items: flex-start;
      gap: 10px;
      list-style: none;
      margin-left: -1.5em;
    }
    .meta-value.checkbox-mode ol {
      padding-left: 1.5em;
    }
    .cb-box {
      flex-shrink: 0;
      width: 14px;
      height: 14px;
      margin-top: 3px;
      border: 1px solid #2a2a2a;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }
    .cb-box.checked {
      border-color: #9b59f7;
      background: #110022;
    }
    .cb-box.checked::after {
      content: '';
      width: 7px;
      height: 4px;
      border-left: 1.5px solid #9b59f7;
      border-bottom: 1.5px solid #9b59f7;
      transform: rotate(-45deg) translateY(-1px);
      display: block;
    }
    .cb-done {
      text-decoration: line-through;
      color: #333 !important;
    }
    .cb-done .tip { color: #2a2a2a !important; }
    .lib-categories {
      display: flex;
      gap: 8px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    .lib-cat {
      background: #0a0a0a;
      border: 1px solid #1a1a1f;
      color: #555;
      padding: 7px 16px;
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.75em;
      cursor: pointer;
      text-transform: uppercase;
      transition: all 0.2s ease;
    }
    .lib-cat:hover { border-color: #444; color: #888; }
    .lib-cat.active { background: #110022; border-color: #9b59f7; color: #9b59f7; }

    .lib-file-tabs {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
      margin-bottom: 20px;
      border-bottom: 1px solid #111115;
      padding-bottom: 14px;
    }
    .lib-file-tab {
      background: #0a0a0a;
      border: 1px solid #1a1a1f;
      color: #444;
      padding: 5px 12px;
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.7em;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .lib-file-tab:hover { border-color: #333; color: #777; }
    .lib-file-tab.active { background: #0c0015; border-color: #9b59f7; color: #9b59f7; }

    .lib-img-wrap {
      background: #0a0a0a;
      border: 1px solid #111115;
      padding: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 300px;
    }
    .lib-img-wrap img {
      max-width: 100%;
      max-height: 600px;
      object-fit: contain;
      display: block;
    }

    @media (max-width: 768px) {
      .top-nav-row { flex-direction: column; align-items: flex-start; }
      .guide-container { grid-template-columns: 1fr; }
      .sidebar-dots { display: none; }
    }
  </style>
</head>
<body>

  <section id="country-selector">
    <header>
      <h1>HOI4 Guides</h1>
      <p style="color: #444450; font-family: 'JetBrains Mono', monospace; font-size: 0.85em; margin-top: 10px;">Select a nation for meta strategies</p>
    </header>

    <div class="grid">
      <div class="country-card" onclick="openGuide('USSR')">
        <div>
          <h3>USSR</h3>
          <p>Guide for Union of Soviet Socialist Republics</p>
        </div>
        <span class="highlight" style="font-size: 0.7em; font-family: 'JetBrains Mono', monospace;">OPEN GUIDE</span>
      </div>

      <div class="country-card disabled">
        <div>
          <h3>GERMANY</h3>
          <p>Guide for German Reich</p>
        </div>
        <span style="font-size: 0.7em; font-family: 'JetBrains Mono', monospace; color: #444;">COMING SOON</span>
      </div>

      <div class="country-card disabled" style="border-color:#1a1a00; filter: grayscale(1);">
        <div>
          <h3 style="color:#444;">⚠ DEV</h3>
          <p style="color:#333;">Only for Developers — view and edit the missing items list.</p>
        </div>
        <span style="font-size:0.7em; font-family:'JetBrains Mono',monospace; color:#333;">DISABLED</span>
      </div>
    </div>
  </section>

  <!-- Dev Modal -->
  <div id="dev-modal-overlay" onclick="closeDevModal()" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.85); z-index:1000;"></div>
  <div id="dev-modal" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); z-index:1001; background:#080808; border:1px solid #f0c040; padding:36px 40px; width:min(680px,95vw); max-height:85vh; overflow-y:auto; box-sizing:border-box;">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:24px;">
      <h2 style="margin:0; color:#f0c040; font-family:'JetBrains Mono',monospace; font-size:1em; text-transform:uppercase; letter-spacing:0.1em;">⚠ Developer — What is Missing</h2>
      <button onclick="closeDevModal()" style="background:transparent; border:none; color:#666; font-size:1.4em; cursor:pointer; line-height:1;">&times;</button>
    </div>
    <p style="color:#444; font-family:'JetBrains Mono',monospace; font-size:0.72em; margin:0 0 20px; text-transform:uppercase; letter-spacing:0.08em;">USSR — Missing / To Do</p>
    <div id="dev-todo-list"></div>
    <div style="display:flex; gap:8px; margin-top:24px; border-top:1px solid #1a1a1a; padding-top:20px;">
      <input id="dev-new-input" type="text" placeholder="Add new item..." style="flex:1; background:#0a0a0a; border:1px solid #222; color:#a8a8b0; padding:8px 12px; font-family:'JetBrains Mono',monospace; font-size:0.8em; outline:none;" onkeydown="if(event.key==='Enter') addDevItem()" />
      <button onclick="addDevItem()" style="background:#0c0015; border:1px solid #f0c040; color:#f0c040; padding:8px 16px; font-family:'JetBrains Mono',monospace; font-size:0.75em; cursor:pointer; white-space:nowrap;">+ ADD</button>
    </div>
  </div>

  <section id="guide-interface">
    <button id="back-btn" onclick="closeGuide()">&larr; Back to Selection</button>
    <h1 id="active-country-name">USSR</h1>
    <p style="color: #444450; font-family: 'JetBrains Mono', monospace; font-size: 0.78em; margin: -4px 0 0;">Union of Soviet Socialist Republics</p>
    
    <div class="top-nav-row">
      <div class="info-badge">
        STRATEGY UNTIL: 01. FEB 1941
      </div>

      <div style="display:flex; align-items:center; gap:10px;">
        <button id="checkbox-btn" class="screenshot-trigger" onclick="toggleCheckboxMode()" style="font-size:0.75em; padding:6px 14px;">
          <svg width="13" height="13" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><rect x="1" y="1" width="14" height="14" rx="2"/><path d="M4 8l3 3 5-5"/></svg>
          CHECKBOXES
        </button>
        <button id="screenshot-btn" class="screenshot-trigger" onclick="toggleLibrary()">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg>
          SCREENSHOTS
        </button>
      </div>
    </div>

    <div class="guide-container">
      <!-- Sidebar Desktop -->
      <div id="standard-sidebar" class="sidebar-dots">
        <div class="tab-item active" data-id="Focuses" onclick="setTab('Focuses')">
          <div class="tab-dot"></div><span class="tab-label">Focus Tree</span>
        </div>
        <div class="tab-item" data-id="Research" onclick="setTab('Research')">
          <div class="tab-dot"></div><span class="tab-label">Research</span>
        </div>
        <div class="tab-item" data-id="Production" onclick="setTab('Production')">
          <div class="tab-dot"></div><span class="tab-label">Production</span>
        </div>
        <div class="tab-item" data-id="PP Picks" onclick="setTab('PP Picks')">
          <div class="tab-dot"></div><span class="tab-label">PP Picks</span>
        </div>
        <div class="tab-item" data-id="MIOs" onclick="setTab('MIOs')">
          <div class="tab-dot"></div><span class="tab-label">MIOs</span>
        </div>
        <div class="tab-item" data-id="Spies" onclick="setTab('Spies')">
          <div class="tab-dot"></div><span class="tab-label">Spies</span>
        </div>
        <div class="tab-item" data-id="General" onclick="setTab('General')">
          <div class="tab-dot"></div><span class="tab-label">General</span>
        </div>
      </div>

      <div class="content-box">
        <!-- Mini Tabs for easy mobile access or quick switching -->
        <div class="mini-tabs">
          <div class="mini-tab active" data-id="Focuses" onclick="setTab('Focuses')">Focus</div>
          <div class="mini-tab" data-id="Research" onclick="setTab('Research')">Research</div>
          <div class="mini-tab" data-id="Production" onclick="setTab('Production')">Prod</div>
          <div class="mini-tab" data-id="PP Picks" onclick="setTab('PP Picks')">PP</div>
          <div class="mini-tab" data-id="MIOs" onclick="setTab('MIOs')">MIO</div>
          <div class="mini-tab" data-id="Spies" onclick="setTab('Spies')">Spies</div>
          <div class="mini-tab" data-id="General" onclick="setTab('General')">General</div>
        </div>

        <h2 id="content-title">Focus Tree <span class="highlight">// Chronological</span></h2>
        <div id="content-body">
          <div id="meta-display" class="meta-value"></div>
          <div id="library-display" style="display: none;">
            <div class="lib-categories">
              <button class="lib-cat active" onclick="setLibCat('mios')">MIOs</button>
              <button class="lib-cat" onclick="setLibCat('tank')">Tank Templates</button>
              <button class="lib-cat" onclick="setLibCat('production')">Production &amp; Templates</button>
            </div>
            <div id="lib-file-tabs" class="lib-file-tabs"></div>
            <div id="lib-img-wrap" class="lib-img-wrap">
              <img id="lib-img" src="" alt="" />
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <script>
    let currentCountry = "";
    let currentTab = "Focuses";
    let isLibraryOpen = false;

    const database = {
      "USSR": {
        "Focuses": `<ol>
<li>The Path of Marxism and Leninism</li>
<li>The Centre</li>
<li>The Stalin Constitution</li>
<li>The Zinovyevite Terrorist Center</li>
<li>Heavy Industry</li>
<li>Addressing Internal Affairs</li>
<li>The New Soviet Woman</li>
<li>Infrastructure Effort</li>
<li>The Comintern</li>
<li>The Anti-Soviet Trotskyist Center</li>
<li>Expand the Agitprop</li>
<li>NKVD Primacy</li>
<li>The Workers Dictatorship</li>
<li>Found the PCDI</li>
<li>The Military Conspiracy</li>
<li>Finish the Five Year Plan</li>
<li>Foreign Experts</li>
<li>Behead the Snake</li>
<li>Eastern Development</li>
<li>The Bloc of Rights and Trotskyites</li>
<li>Develop the Urals</li>
<li>The USSR Academy of Sciences</li>
<li>Baltic Security</li>
<li>Claims in the Baltics</li>
<li>PC of Mechanical Engineering</li>
<li>The Means to Wage War</li>
<li>Development of Tankograd</li>
<li>Merge Tank and Material Plants</li>
<li>Third Five Year Plan</li>
<li>Reorganize the PC of Heavy Industry</li>
<li>Industrial Modernization</li>
<li>Superior War Machines</li>
<li>Soviet Artillery</li>
<li>Claim on Bessarabia</li>
<li>Positive Heroism</li>
<li>Strengthen the Mobilization Plan</li>
<li>Cohesion First</li>
<li>Rehabilitated Military</li>
<li>Military Reorganization</li>
</ol>`,

        "Research": `<ol>
<li>Electronic Mechanical Engineering</li>
<li>Construction 1</li>
<li><span class="tip">Wait 30 days, swap Engineering for Machine Tools, then re-add Engineering to unlock it 30 days earlier</span></li>
<li>Mechanical Computing</li>
<li>Concentrated Industry 1</li>
<li>Construction 2</li>
<li>Improved Machine Tools</li>
<li>Concentrated Industry 2</li>
<li>1934 Heavy Tank <span class="tip">[use Mytishchy Machine Building]</span></li>
<li>Anti-Tank 1 <span class="tip">[use MIO]</span></li>
<li>Radio 1</li>
<li>Field Hospital 1 <span class="tip">[use Mytishchy Machine Building]</span></li>
<li>Logistics Company 1 <span class="tip">[use Mytishchy Machine Building]</span></li>
<li>Basic Armor Protection <span class="tip">[use Mytishchy Machine Building]</span></li>
<li>Armored Trains <span class="tip">[use MIO]</span></li>
<li>Anti-Tank Upgrade <span class="tip">[use MIO]</span></li>
<li>Improved Armor Protection <span class="tip">[use Mytishchy Machine Building]</span></li>
<li>Advanced Machine Tools</li>
<li>Concentrated Industry 3</li>
<li>Construction 3</li>
<li>Signal Company 1 <span class="tip">[use MIO]</span></li>
<li>Anti-Tank 2 <span class="tip">[license it if possible for a 20% research bonus]</span></li>
<li>Mechanized <span class="tip">[use MIO]</span></li>
<li>Improved Infantry 1 <span class="tip">[use MIO]</span></li>
<li>Radio 2</li>
<li>1938 Basic Medium Tank</li>
<li>Improved Anti-Tank Upgrade 1 <span class="tip">[use Mytishchy Machine Building]</span></li>
<li>Rifle Upgrade <span class="tip">[use MIO]</span></li>
<li>Construction 4</li>
<li>Assembly Line Production</li>
<li>Concentrated Industry 4</li>
<li>Improved Anti-Tank Upgrade 2 <span class="tip">[use MIO]</span></li>
<li>Advanced Anti-Tank <span class="tip">[use MIO]</span></li>
<li>Engineer Company 2 <span class="tip">[use MIO]</span></li>
<li>Streamlined Line</li>
<li>Logistics Company 2 <span class="tip">[use Mytishchy Machine Building]</span></li>
<li>Signal Company 2 <span class="tip">[use MIO]</span></li>
<li>Field Hospital 2 <span class="tip">[use Mytishchy Machine Building]</span></li>
<li>Weapons Upgrade 2 <span class="tip">[use MIO]</span></li>
<li>Improved Infantry 2 <span class="tip">[use MIO]</span></li>
<li>Armored Engineer Company <span class="tip">[use MIO]</span></li>
<li>Advanced Flamethrower <span class="tip">[use Mytishchy Machine Building]</span></li>
</ol>`,

        "Production": `<span class="section-head">At Game Start</span>
<ul>
<li>12 factories on Guns</li>
<li>9 factories on Support Equipment</li>
<li>1 factory on Improved Light Tank</li>
<li>2 factories on Trucks</li>
<li>9 factories on Anti-Air</li>
<li>Delete all remaining lines, finish building ships, then start producing Convoys</li>
</ul>
<span class="section-head">~September 15, 1937</span>
<ul>
<li>Switch to: 7 Heavy Tanks + 5 Infantry Equipment</li>
</ul>
<span class="section-head">Light Recon Tank <span style="font-size:0.8em; opacity:0.6;">~Mid 1937</span></span>
<ul>
<li>Start designing the Light Recon Tank from the screenshots and replace it with your current production line Light Tank</li>
</ul>
<span class="section-head">~End of December 1937</span>
<ul>
<li>20 factories on Infantry Equipment, 50 on Heavy Tanks (prioritize Infantry over Tanks)</li>
<li>Once Armored Trains is researched: add 1 factory and move it to the top</li>
</ul>
<span class="section-head">Early 1938</span>
<ul>
<li>Start researching Flame Tanks</li>
</ul>
<span class="section-head">Mid-1938</span>
<ul>
<li>Add 1 factory on Inter-War Medium Tanks (convert later to Flame Tanks — see screenshots for the correct design)</li>
<li>If you have surplus factories: increase Heavy Tanks to 100 factories</li>
<li>Once Mechanized Equipment is researched: add 25 factories and prioritize it</li>
</ul>
<span class="section-head">~October 1940</span>
<ul>
<li>Now start creating the best heavy tank template and start converting it as shown in the screenshot</li>
<li><span class="tip">Note: Create a normal heavy design as shown in the screenshots, then edit this template and create a Tank Destroyer template out of it. After you did that, replace your heavy tank production line with the normal designed heavy tank, then instantly replace it with the heavy tank destroyer variant.</span></li>
</ul>
<span class="section-head">~1941</span>
<ul>
<li>When you have finished researching Armored Engineer Company, put 5 factories on it and prioritize it</li>
</ul>
<span class="section-head">Notes</span>
<ul>
<li>Create and upgrade tank templates as shown in the named screenshots</li>
<li>Make sure to always convert your new equipment</li>
<li>The army shown in the screenshot: 296 divisions are the normal infantry template, 56 are the tank templates, and 24 are the AA templates</li>
<li>Create the tank design from the template — you can change it to a more offensive one by removing one Mechanized and adding one Tank Destroyer from the screenshot. The trick is to create the template, duplicate it, then uncheck every single equipment and convert your tank divisions to the one without equipment, then convert it to the real tank template. Make sure to change it to Armored Engineer later and convert it with the same trick.</li>
</ul>`,

        "PP Picks": `<ol>
<li>Improved Workers Conditions</li>
<li>Attache to Spain</li>
<li>War Economy</li>
<li>Captain of Industry</li>
<li>Popular Figurehead</li>
<li>Army Reformer</li>
<li>"We Will Accomplish a High Yield" <span class="tip">(repeat this pick continuously)</span></li>
<li>Attache to China <span class="tip">(~November 1937)</span></li>
<li>Construction Company</li>
<li>Bring American Experts</li>
<li>Specialization in Military Industry</li>
<li>All Baltic Annexation Buttons</li>
<li>Land Warfare Scientist</li>
<li>Military Theorist</li>
<li>Limited Exports</li>
<li>Extensive Conscription</li>
<li>Concealment Expert</li>
</ol>`,

        "MIOs": `<span class="section-head">Setup</span>
<ul>
<li>Assign the Mytishchy Machine Building MIO to the Support Equipment production line</li>
<li>Follow the trait order shown in the screenshots</li>
</ul>
<span class="section-head">Switching MIOs</span>
<ul>
<li>Once the MIO reaches Level 7, switch it away from the Light Tank and Heavy Tank lines</li>
<li>Reassign the Mytishchy Machine Building MIO to those lines</li>
</ul>`,

        "Spies": `<span class="section-head">Agency Upgrades (in order)</span>
<ol>
<li>Suicide Pills <span class="tip">(January 31)</span></li>
<li>Passive Defense to Level 4
<ul><li>Wait until you complete the "Expand the Agitprop" focus before upgrading — because otherwise it would kill your civilian building in the first year</li></ul>
</li>
<li>Invisible Inc.</li>
<li>Interrogation Techniques</li>
</ol>
<span class="section-head">Operations</span>
<ol>
<li>Send your first spy to one of the Baltic nations
<ul>
<li>Goal: establish 1 Collaboration Government in each Baltic nation</li>
<li>Wait until the spy network reaches 50%, then switch it to "Quiet Intel Network"</li>
<li>Always use spies with German nationality</li>
</ul>
</li>
<li>Once you have 2 spies available, begin Collaboration Government operations in all Baltic nations, and later start 2 Collaboration Governments in Finland as well</li>
</ol>`,

        "General": `<ol>
<li>Create a Spy Agency immediately at game start</li>
<li>Sell all aircraft on the market</li>
<li>Merge all troops into one army (no general) and distribute them across the mainland — do not concentrate east of Moscow</li>
<li>Merge the entire Navy at Leningrad — you will need it later</li>
<li>Match all production line MIOs to the ones shown in the screenshots</li>
<li>When the Spanish Civil War starts: send 3 Tank divisions + 3 Infantry divisions + an Attache <span class="tip">(improve relations first if needed)</span></li>
<li>After sending volunteers to Spain, disband all NKVD divisions</li>
<li>Paranoia Events: do NOT lose key generals (e.g., Zhukov), the Captain of Industry advisor, or any construction bonuses</li>
<li>After completing the "Foreign Experts" focus: reduce Civilian Factory construction to 1 and begin building Military Factories</li>
<li>Once you build in the prioritized states of 80%+ infrastructure, build up to 3 Military Factories in the Urals on min 10 tiles — a later focus rewards this</li>
<li>You can skip the "Secure Leningrad" focus by manually justifying a war goal on Finland <span class="tip">(recommended: start justification in early 1939)</span></li>
<li>Complete building a Land Warfare Research Facility by the start of 1939</li>
<li>~October 1939: Begin training 300+ basic Infantry divisions — use the template shown in the screenshots</li>
<li>If you run low on Infantry Equipment, increase Military Factory allocation to 25–30</li>
<li>If you forgot it earlier: the absolute latest point to start is when Military Reorganization is completed — convert all your tank division templates to tanks</li>
</ol>`
      }
    };

    function openGuide(country) {
      currentCountry = country;
      document.getElementById('active-country-name').innerText = country;
      document.getElementById('country-selector').style.display = 'none';
      document.getElementById('guide-interface').style.display = 'block';
      currentTab = "Focuses";
      document.querySelectorAll('.tab-item, .mini-tab').forEach(el => {
        el.classList.toggle('active', el.getAttribute('data-id') === 'Focuses');
      });
      updateDisplay();
    }

    function closeGuide() {
      document.getElementById('country-selector').style.display = 'block';
      document.getElementById('guide-interface').style.display = 'none';
    }

    // ── Screenshot library ──────────────────────────────────────────
    const GITHUB_RAW = "https://raw.githubusercontent.com/";
    // Set your GitHub username/repo here:
    const REPO = "Nico-Shock/HOI4-Guides/main";

    const screenshotLibrary = {
      mios: [
        { label: "Mytishchy Machine Building", file: "mios/mytishchy machine building.png" },
        { label: "OKMO",                       file: "mios/okmo.png" }
      ],
      tank: [
        { label: "Flame Tank 1",                    file: "tank/flame tank 1.png" },
        { label: "Flame Tank 2",                    file: "tank/flame tank (2).png" },
        { label: "Light Recon 1 (1937)",            file: "tank/light recon 1 (1937).png" },
        { label: "Light Recon 2 (after Flame Tank)",file: "tank/light recon 2 (after flame tank).png" },
        { label: "1934 Heavy Tank with OKMO",       file: "tank/1934 heavy tank with okmo.png" },
        { label: "Heavy Tank 2",                    file: "tank/heavy tank 2.png" },
        { label: "Heavy Tank 3",                    file: "tank/heavy tank 3.png" }
      ],
      production: [
        { label: "AA Trick Template",  file: "production/aa trick template.png" },
        { label: "Inf Template",       file: "production/inf template.png" },
        { label: "15 Sep 1937",        file: "production/15 sep 1937.png" },
        { label: "May 1938",           file: "production/may 1938.png" },
        { label: "Mai 1940",           file: "production/mai 1940.png" },
        { label: "1 Jan",              file: "production/1 jan.png" },
        { label: "Army Example",         file: "production/army shown.png" },
        { label: "Final Tank",         file: "production/final tank.png" },
        { label: "Okt 1940",           file: "production/okt 1940.png" }
      ]
    };

    let currentLibCat = "mios";
    let currentLibFile = 0;

    function setLibCat(cat) {
      currentLibCat = cat;
      currentLibFile = 0;
      document.querySelectorAll('.lib-cat').forEach(el => {
        el.classList.toggle('active', el.getAttribute('onclick').includes("'" + cat + "'"));
      });
      renderLibFileTabs();
      renderLibImage();
    }

    function setLibFile(idx) {
      currentLibFile = idx;
      document.querySelectorAll('.lib-file-tab').forEach((el, i) => {
        el.classList.toggle('active', i === idx);
      });
      renderLibImage();
    }

    function renderLibFileTabs() {
      const files = screenshotLibrary[currentLibCat];
      const container = document.getElementById('lib-file-tabs');
      container.innerHTML = files.map((f, i) =>
        `<div class="lib-file-tab${i === 0 ? ' active' : ''}" onclick="setLibFile(${i})">${f.label}</div>`
      ).join('');
    }

    function renderLibImage() {
      const files = screenshotLibrary[currentLibCat];
      const f = files[currentLibFile];
      const img = document.getElementById('lib-img');
      img.src = `${GITHUB_RAW}${REPO}/${f.file}`;
      img.alt = f.label;
    }

    function toggleLibrary() {
      isLibraryOpen = !isLibraryOpen;
      const btn = document.getElementById('screenshot-btn');
      btn.classList.toggle('active', isLibraryOpen);
      if (isLibraryOpen) {
        renderLibFileTabs();
        renderLibImage();
      }
      updateDisplay();
    }

    function setTab(tab) {
      currentTab = tab;
      isLibraryOpen = false;
      document.getElementById('screenshot-btn').classList.remove('active');
      
      document.querySelectorAll('.tab-item, .mini-tab').forEach(el => {
        el.classList.toggle('active', el.getAttribute('data-id') === tab);
      });
      
      updateDisplay();
    }

    function updateDisplay() {
      const title = document.getElementById('content-title');
      const metaBox = document.getElementById('meta-display');
      const libraryBox = document.getElementById('library-display');
      
      const tabLabels = {
        'Focuses': 'Focus Tree',
        'Research': 'Research',
        'Production': 'Production',
        'PP Picks': 'Political Power',
        'MIOs': 'MIOs',
        'Spies': 'Espionage',
        'General': 'General'
      };

      if (isLibraryOpen) {
        title.innerHTML = `Screenshots <span class="highlight">// Reference Library</span>`;
        metaBox.style.display = 'none';
        libraryBox.style.display = 'block';
      } else {
        title.innerHTML = `${tabLabels[currentTab]} <span class="highlight">// Chronological</span>`;
        metaBox.style.display = 'block';
        libraryBox.style.display = 'none';
        
        const content = database[currentCountry]?.[currentTab];
        metaBox.innerHTML = content || "No data available for this section.";
        metaBox.classList.remove('checkbox-mode');
        applyCheckboxMode(metaBox, currentTab);
      }
    }
    // ── Checkbox Mode ────────────────────────────────────────────────
    let checkboxMode = false;
    const checkboxTabs = ['Focuses', 'Research', 'PP Picks'];
    // checked state: { tabKey: Set of indices }
    const checkedState = { Focuses: new Set(), Research: new Set(), 'PP Picks': new Set() };

    function toggleCheckboxMode() {
      checkboxMode = !checkboxMode;
      document.getElementById('checkbox-btn').classList.toggle('active', checkboxMode);
      updateDisplay();
    }

    function applyCheckboxMode(metaBox, tab) {
      if (!checkboxMode || !checkboxTabs.includes(tab)) return;
      metaBox.classList.add('checkbox-mode');
      const items = metaBox.querySelectorAll('ol > li');
      items.forEach((li, idx) => {
        const checked = checkedState[tab].has(idx);
        const inner = li.innerHTML;
        li.innerHTML = `<span class="cb-box${checked ? ' checked' : ''}"></span><span class="${checked ? 'cb-done' : ''}">${inner}</span>`;
        li.style.cursor = 'pointer';
        li.onclick = () => toggleCbItem(tab, idx, li);
      });
    }

    function toggleCbItem(tab, idx, li) {
      const checked = checkedState[tab].has(idx);
      if (checked) checkedState[tab].delete(idx);
      else checkedState[tab].add(idx);
      const box = li.querySelector('.cb-box');
      const text = li.querySelector('span:last-child');
      box.classList.toggle('checked', !checked);
      text.classList.toggle('cb-done', !checked);
    }

    // ── Developer Modal ─────────────────────────────────────────────
    let devItems = [
      { id: 1, text: "Late tank template + conversion", done: false },
      { id: 2, text: "PP picks for later",              done: false },
      { id: 3, text: "Doctrines",                       done: false },
      { id: 4, text: "Correcting research order",       done: false }
    ];
    let devNextId = 5;

    function openDevModal() {
      document.getElementById('dev-modal-overlay').style.display = 'block';
      document.getElementById('dev-modal').style.display = 'block';
      renderDevList();
    }
    function closeDevModal() {
      document.getElementById('dev-modal-overlay').style.display = 'none';
      document.getElementById('dev-modal').style.display = 'none';
    }

    function renderDevList() {
      const container = document.getElementById('dev-todo-list');
      if (devItems.length === 0) {
        container.innerHTML = '<p style="color:#333; font-family:\'JetBrains Mono\',monospace; font-size:0.8em;">Nothing missing — all good.</p>';
        return;
      }
      container.innerHTML = devItems.map(item => `
        <div style="display:flex; align-items:flex-start; gap:12px; padding:10px 0; border-bottom:1px solid #111; group" id="dev-item-${item.id}">
          <span onclick="toggleDevItem(${item.id})" style="cursor:pointer; margin-top:2px; flex-shrink:0;">
            ${item.done
              ? '<svg width="16" height="16" viewBox="0 0 16 16" fill="none"><rect x="0.5" y="0.5" width="15" height="15" rx="1" stroke="#3a3a3a"/><path d="M4 8l3 3 5-5" stroke="#9b59f7" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>'
              : '<svg width="16" height="16" viewBox="0 0 16 16" fill="none"><rect x="0.5" y="0.5" width="15" height="15" rx="1" stroke="#2a2a2a"/></svg>'
            }
          </span>
          <div style="flex:1; min-width:0;" id="dev-text-wrap-${item.id}">
            <span onclick="startEditDevItem(${item.id})" style="font-family:'JetBrains Mono',monospace; font-size:0.85em; color:${item.done ? '#333' : '#a8a8b0'}; text-decoration:${item.done ? 'line-through' : 'none'}; cursor:text; word-break:break-word;">${escHtml(item.text)}</span>
          </div>
          <button onclick="deleteDevItem(${item.id})" style="background:transparent; border:none; color:#2a2a2a; cursor:pointer; font-size:1em; padding:0; flex-shrink:0; line-height:1;" title="Delete">&times;</button>
        </div>
      `).join('');
    }

    function toggleDevItem(id) {
      const item = devItems.find(i => i.id === id);
      if (item) { item.done = !item.done; renderDevList(); }
    }

    function deleteDevItem(id) {
      devItems = devItems.filter(i => i.id !== id);
      renderDevList();
    }

    function startEditDevItem(id) {
      const item = devItems.find(i => i.id === id);
      if (!item) return;
      const wrap = document.getElementById('dev-text-wrap-' + id);
      wrap.innerHTML = `<input type="text" value="${escHtml(item.text)}" 
        style="width:100%; background:#0a0a0a; border:1px solid #f0c040; color:#fff; padding:4px 8px; font-family:'JetBrains Mono',monospace; font-size:0.85em; outline:none;"
        onblur="saveEditDevItem(${id}, this.value)"
        onkeydown="if(event.key==='Enter'||event.key==='Escape') this.blur()"
        autofocus />`;
      wrap.querySelector('input').focus();
    }

    function saveEditDevItem(id, value) {
      const item = devItems.find(i => i.id === id);
      if (item && value.trim()) item.text = value.trim();
      renderDevList();
    }

    function addDevItem() {
      const input = document.getElementById('dev-new-input');
      const text = input.value.trim();
      if (!text) return;
      devItems.push({ id: devNextId++, text, done: false });
      input.value = '';
      renderDevList();
    }

    function escHtml(s) {
      return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
    }
  </script>
</body>
</html>
